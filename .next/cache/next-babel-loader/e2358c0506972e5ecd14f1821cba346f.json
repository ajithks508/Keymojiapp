{"ast":null,"code":"import fetch from 'node-fetch';\nimport { ApolloClient } from 'apollo-client';\nimport { InMemoryCache } from 'apollo-cache-inmemory';\nimport { createHttpLink } from 'apollo-link-http';\nimport { ApolloLink } from \"apollo-link\";\nimport { IntrospectionFragmentMatcher } from 'apollo-cache-inmemory';\nimport introspectionQueryResultData from '../fragmentTypes';\nimport clientConfig from './../client-config'; // Fragment matcher.\n\nvar fragmentMatcher = new IntrospectionFragmentMatcher({\n  introspectionQueryResultData: introspectionQueryResultData\n});\nexport var middleware = new ApolloLink(function (operation, forward) {\n  /**\r\n   * If session data exist in local storage, set value as session header.\r\n   */\n  var session = true ? localStorage.getItem(\"woo-session\") : null;\n\n  if (session) {\n    operation.setContext(function (_ref) {\n      var _ref$headers = _ref.headers,\n          headers = _ref$headers === void 0 ? {} : _ref$headers;\n      return {\n        headers: {\n          \"woocommerce-session\": \"Session \".concat(session)\n        }\n      };\n    });\n  }\n\n  return forward(operation);\n});\n/**\r\n * Afterware operation.\r\n *\r\n * This catches the incoming session token and stores it in localStorage, for future GraphQL requests.\r\n */\n\nexport var afterware = new ApolloLink(function (operation, forward) {\n  return forward(operation).map(function (response) {\n    /**\r\n     * Check for session header and update session in local storage accordingly.\r\n     */\n    var context = operation.getContext();\n    var headers = context.response.headers;\n    var session = headers.get(\"woocommerce-session\");\n\n    if (session) {\n      // Remove session data if session destroyed.\n      if (\"false\" === session) {\n        localStorage.removeItem(\"woo-session\"); // Update session new data if changed.\n      } else if (localStorage.getItem(\"woo-session\") !== session) {\n        localStorage.setItem(\"woo-session\", headers.get(\"woocommerce-session\"));\n      }\n    }\n\n    return response;\n  });\n}); // Apollo GraphQL client.\n\nvar client = new ApolloClient({\n  link: middleware.concat(afterware.concat(createHttpLink({\n    uri: clientConfig.graphqlUrl,\n    fetch: fetch\n  }))),\n  cache: new InMemoryCache({\n    fragmentMatcher: fragmentMatcher\n  })\n});\nexport default client;","map":null,"metadata":{},"sourceType":"module"}